{"componentChunkName":"component---src-templates-blog-post-js","path":"/power-analysis/","result":{"data":{"site":{"siteMetadata":{"title":"Out of Order Core"}},"markdownRemark":{"id":"aa7d2a4b-b08d-53e8-9690-b5374fa7095b","excerpt":"In our last few posts we looked at Timing Analysis and techniques such as Flush and Reload, and Prime and Probe that exploit timing difference to deduce…","html":"<p>In our last few posts we looked at <strong>Timing Analysis</strong> and techniques such as <strong>Flush and Reload</strong>, and <strong>Prime and Probe</strong> that exploit timing difference to deduce operations of victim.</p>\n<p>Looking at Timing Analysis, we observe how we exploit the lack of uniformity within the system to observe the victim. In timing analysis, we exploit the timing difference between loading data from cache and loading data from main memory as a device to observe bits of program victim is executing. If this execution pattern depends on some secret held by the victim, we can infer details about the secret from the patter on execution of victim thread.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACyklEQVQ4y52Ua0hTYRjH/+ecHbfp5izzPjdjSa2L1jRzkVpmroTUjDQS8tIHU8gumoWXtNvSIEIKpITAwqiIoA8JYQ2CCKKLfQrDL2U2L6yIaKHT7YkzNznIpqvny/ucl+f839/7XF4gMJMBeMKySGAY9zeDf7C5YJmU45QKCULk3OGIcOkPAEpRDPO/wmzxbs1wSb52UPC9e74A/AnkAYgWHI51b1U/7M6g/QVaC1E/RgcKOU/cagCZC4l6T80HcFxwiCpwoSHJ8vVtEaWnRD/q6tiKxqMGiSfuPICUxSjdFqrkVSt1oVgaJj049qHQMTJQRmv1sd0bDTr8GW7kt2yKFw4PDkhMRKrYszPuG42X07tnhyiIl5h7u4pARCDqRSBiHMcxSFCHeHPU8PRuFpHz1NTQ61rKMmqGzU3Ztzovmm5HRypeAIgXAXC+Fdm5A5eUFmmtNFFOM6ONTppocTmsTeQca6bxj3WUZoh7M5tj8ku3DEAVz7MamdR949b+e9uIftY7JkdaXc7xMzRtbXbStHnqevsuQWW76N81AMpFOZ0lAlCSpA8T1vC6qlU2clQS2U846VcDzViPEdlaZmyD9ZS6PsZC9AD2L6e9uU4EUAhA7o+2raYskXo6ja6rbRuo704GuUYOuGjyrPPaJTedSQiScCzHsszCRYkMlyKIZ7UAjAAMADbnZEQNka2Svn+qo5TkWAtRH4heiceO8VsUYW6DePFUQXqkYsVnslfTlXO5Al3uvNYKeJYjPKumqVZvp981tC9/3f3ZHnRXViBSBdrQxQBOevzkm5fT6OXjvKlQVYwuXh0DY6raez2zkJJASLMZxt1GguXc6EijHZlRz0V03p+XA0gP6OpEPUjSh0ETF1xaYFILKjnewvkQWDSPjFzGSVRKHnIZ1x7Es+91WgUKTGpGESKZ/9wFXBQvSRuAvT4eVb/2F7tT64g3/06pAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"A lightning icon representing power\"\n        title=\"A lightning icon representing power\"\n        src=\"/static/155b1790b33ed2a86c8a1ef1d741a776/01e7c/power.png\"\n        srcset=\"/static/155b1790b33ed2a86c8a1ef1d741a776/c26ae/power.png 158w,\n/static/155b1790b33ed2a86c8a1ef1d741a776/6bdcf/power.png 315w,\n/static/155b1790b33ed2a86c8a1ef1d741a776/01e7c/power.png 512w\"\n        sizes=\"(max-width: 512px) 100vw, 512px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<center>\nAlt: A lightning icon representing power\n<br/>\nSource: Icons made by <a href=\"https://www.freepik.com/\" target=\"_blank\">Freepik</a> (link opens a new tab) from <a href=\"https://www.flaticon.com/\" target=\"_blank\">Flaticons</a> (link opens a new tab)\n</center>\n<h2>Energy and Execution</h2>\n<p>Modern microprocessors are complex feat with multiple physical cores and multiple different functional unit - Arithmetic and Logic Unit (ALU) to process integers, Floating Point Unit, Single Instruction Multiple Data (SIMD) units such as the ones that operate via AVX Instructions in x86 architecture.</p>\n<p>With different circuits having different complexity, they have different power draws. A careful observer with a device that can accurately measure power consumption can deduce information about runtime of victim.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.84810126582278%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAADmUlEQVQozy3S/U8bdQDH8f5byg9bImPLTDbM5ozRH1zUH0w0ShSYms3ULDgYAfaAlOe1lUJh2KJmQh1jBVKhz0/0Su/a612v99B77PUee71+tcn+gNcn+SRvB64bd89hZxnL1jEMGs2dftDcGVR8V6HZd8qu/vL8JXz5CrZ0mfFc1TcGmHSQb2oc2zBNEwDgqJrNITT0beUfTBcM6URgdxU4oBS22Ixfgp6TCS986CqF59iUT4M2VQ7pAqAqCs/zPYy281+QfV/RF6BmyjABrxhBbW0NPN3o/LpITs3VxqdLzllizGfPeuxHRSsNANBNnReEHpa73HZtfode4RVS2M/wWeiP+pKnPBZiPYs559+NVX9lZhOfCXHupdK9eCOsyYZhGm9wb0k2Oh1gcCL00cPitPdO9dPb+UsTxPBn0MAY+/Uw+vE3lZtT3OitzFt/ST4AgKYrAs+9waIkKaoK7G6zTNSK8OHB9MHeT9no8knkUbmwlom50nFXKefNRKfwaqTBSZphNIRmDxPt8s+1Tx4wnzMdHABgWYaW9CrHU1ho8nznfjFwDwo4Ky/GyVdT2tFDg0iZqqju35H3hiwecRAW8l3xvdHSTVg6k3mFYukNZe4ZGF+Wf5lEfhiDhh8URp5STq89Od92pjtxIFCW/2J3vc8iEw66UU9m43koZ3Y0s60rukSpZayVJ9RinjiNI+E0GjlvJOt6qabmW3azLRKdwLXu9hWLTjsyEbKQYOE8F3lZwUvN412EgJWTvSpe0NPHRPqIJEvGyV6NQtpwQsxEBJmsst4BduVCm0o5PHergQlyf7nh/h59/Ru9NFQ+/V1cHamEXGxgsua/j7/28K4vkX/9rd3H4tqPHHNWwVf7S0/etpm0I5Y8DxcqUYTYOYzH0Pr2QTSGEsHDRDiPHBWr+0koi5Kbr05ilfopTGyFkwxWUP3viu6LFpVy5Flyw2qt0NgCWlxAoelcbCYXd51nPHT1OVB3TelAZhcI+HE+8SgbXaFwhkVA8Jq9fbn3WeB6rQg8b1lWtwsoSoaxBt+yGdGo0U2KVVnJJDkVxjmKbwEADA7tbPbbvr42GXewLGt3uxTN4DgqsrsSE5Qzbjm2WA5NQi8magdPqi9nxOiynnZbZz69JZhaS0yts1G3rXEOQRAYhmYYtorCxezIWfR2888PO8FbzPqN4tJ1zD2IPhvE3dfNwPutrRt1JIOgNUbUzQ74v7D/AASs/zWE+8RHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Block diagram on Intel Sandy Bridge CPU showing different load store units, ALU units for integers and floating point units.\"\n        title=\"Block diagram on Intel Sandy Bridge CPU showing different load store units, ALU units for integers and floating point units.\"\n        src=\"/static/ee91f859219c36d339bb258a3f3e5294/f058b/block_diagram.png\"\n        srcset=\"/static/ee91f859219c36d339bb258a3f3e5294/c26ae/block_diagram.png 158w,\n/static/ee91f859219c36d339bb258a3f3e5294/6bdcf/block_diagram.png 315w,\n/static/ee91f859219c36d339bb258a3f3e5294/f058b/block_diagram.png 630w,\n/static/ee91f859219c36d339bb258a3f3e5294/ae694/block_diagram.png 850w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<center>\nAlt: Block diagram on Intel Sandy Bridge CPU showing different load store units, ALU units for integers and floating point units.\n<br/>\nSource (link opens a new tab): <a href=\"https://www.researchgate.net/figure/Sandy-Bridge-block-diagram_fig1_220308557\" target=\"_blank\">https://www.researchgate.net/figure/Sandy-Bridge-block-diagram_fig1_220308557</a>\n</center>\n<h2>Device for leak</h2>\n<p>The device for significant leaks using power analysis are generally the ones that are dependent on SIMD circuits. Consider an algorithm that calls a SIMD routine based on value of data. For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>secret<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>secret <span class=\"token operator\">&amp;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">simd_compute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        secret <span class=\"token operator\">=</span> secret <span class=\"token operator\">>></span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here call to <strong>simd_compute()</strong> is queued to the SIMD unit that can do 4x the computation of a Floating Point unit in same number of cycles. What this also means is that it will consume proportional energy to do so. Thus observing the power draw can give an attacker an insight of the victims runtime and sometimes  even leaking secret data.</p>\n<h2>How significant is power draw difference?</h2>\n<p>Using the value measured by Dr. Ian Cutress of AnandTech as reference we can see that a CPU benchmark program that stresses the Single Instruction Single Data (SISD) unit consume not more than 200W</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABcRAAAXEQHKJvM/AAACKklEQVQ4y4VT226bQBDl/38gVVWlrVqlStWnqupDL7KUVFWT1DKOL8IYY2yDLxgCBFgWw+6pZi2cq9SRhhnNzpyd5cxonHNZVRWqqmqsUhLHcdDpdGCaJgzDQL/fh+d5kEKgrusnSnUafcIwVGBSyoOS5HmOKIrA8lz5SZKAMaaKy7LEbrdT2vgkBCgpQJaAhBAHfU4ox/cDmOZYdW5ZFnRdV93TmeowCAJ1CyAfFgPgVfMcsgKclwi3PnrXXXR0XYH+bbdxcXG5ByQgzjmkFNjVAvEtw23KkGYF/CBBsI2edJllKWzbgmWN4LlzmKaBqTPZP9m2bSzmc+yqGmt3i2QdIN1GSIMYsbfBn7MuOkMP7WsHV7qDy76L320b+mCB9sDFRW+BX+0p9N4MOSuhjcdjxEkMnjO4lo0wDBBFN7iJQoRRhO8nX/Dt6AV+HJ/g59E7nJ9+RevNJ5y/PkXr1Qe03n9G6/gjzl6+RbTeQvN9H6vVCmkUI05C1LKCEBWErFCWHK65xMJewBj2YI2HMIZdOBMTjm1jYg0wGQ9hWwac6QScF9AaZvOMQYqGyT0jUkhIeZ8iksfsPyRSscwKhtl0iYIVkJCK1WZ0Hg+vqJuY2PvVXYzytWYr3LmnAO/P2//852JaM/VFwVSANmGz2SiftiQMQ1VAsTiOVRe0fs2GzGYzdZ5lGZbL5V2HBKz+kBCHNaIY+a7rYjQaqX0mYKqhPAKiGW5y6YJ/RAPdkN9zbz4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Power draw of latest Intel 11th Generation Rocket Lake series running Agisoft, CPU power. The average power draw is close to 150W with peak nearing 200W.\"\n        title=\"Power draw of latest Intel 11th Generation Rocket Lake series running Agisoft, CPU power. The average power draw is close to 150W with peak nearing 200W.\"\n        src=\"/static/d00b292d3fd81e7480018df3cd3e9b57/f058b/normal.png\"\n        srcset=\"/static/d00b292d3fd81e7480018df3cd3e9b57/c26ae/normal.png 158w,\n/static/d00b292d3fd81e7480018df3cd3e9b57/6bdcf/normal.png 315w,\n/static/d00b292d3fd81e7480018df3cd3e9b57/f058b/normal.png 630w,\n/static/d00b292d3fd81e7480018df3cd3e9b57/40601/normal.png 945w,\n/static/d00b292d3fd81e7480018df3cd3e9b57/78612/normal.png 1260w,\n/static/d00b292d3fd81e7480018df3cd3e9b57/91b67/normal.png 1527w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<center>\nAlt: Power draw of latest Intel 11th Generation Rocket Lake series running Agisoft, CPU power. The average power draw is close to 150W with peak nearing 200W.\n<br/>\nSource (link opens a new tab): <a href=\"https://www.anandtech.com/show/16495/intel-rocket-lake-14nm-review-11900k-11700k-11600k/5\" target=\"_blank\">https://www.anandtech.com/show/16495/intel-rocket-lake-14nm-review-11900k-11700k-11600k/5</a>\n</center>\n<br/>\n<p>Compare these numbers to power draw of AVX-512 unit, we see the average close to 250W and a peak close to 300W when the SIMD unit is being used.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABcRAAAXEQHKJvM/AAACXElEQVQ4y32Ty27jOBBF/f+flW02nYmRxHYQp23ZkixKfIuUaOk0yJ4YsxoCBYmFwincYt1NjHFNKZFSKt/7/c7hcOD5+Zn9fs9ut+P9/Z3tdsvr62u5v729sT8cCCEwjuMjpmlikyHDMBTYuq4lwjiitcYYg3PuET93pRS/fv1TmmT4x8cHT09PVOczm2VZVtGLTF8zbFkWVv7/rOvC19eBl5cXXrdb9rtdAZ4zUEpJ13VFapoT3o1oZQljJC0r95SIYyhNcsMp3ZnnGW8Ng9QoqRhDLJLvaWaT5/X9/V2KY4i0v690VYusO/pGEJzHXBusNEx+ZGh7tJDIpmeyHnXtMN3A5ANLnuHxeKSqKpZ1Jc0z/a3iWh3pbmdkXaM6gewu1KcK1QrkTSAuV05f7/T1ESVrVNOU2uQ9m8/PT06nU5ndHEa872kvB6Sq0abFmBtGdzRNhZI3hr5l6K907Qk9VITJYkzO/SY6/R/gujIHT4yOoT3jvGQMluAVzvZYK3CmxyhRGsi+QesbaZ5wrse5gTEYNhmWJZeBe1OASlxwVhCiw2eI6fBR482Alh3W9eihoe9r5iliVVNyYXJs8uvm3YrTzGgkU/Ro3WIzJBi8FgVofY81AtW3uFGihoZBVEwxINtvtLoVBQUYY0SIG5fTgXkKRYr1CmUVwUucV9gsadRI0RBnh3WySE9zQA4No5OleQFml1hruN9T2bFhGMoCZ2cI0ZX/vPzZIXk0t7YttluXhaZp/j7oPFM3zV/r5ZOT/Lu8P7mfZtfr9eHrOq9HSo/6aZofls1e/gPRx97EWqU6bAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Power draw of latest Intel 11th Generation Rocket Lake series running 3DPMavx in AVX-512 mode. The average power draw is close to 250W with peak nearing 400W.\"\n        title=\"Power draw of latest Intel 11th Generation Rocket Lake series running 3DPMavx in AVX-512 mode. The average power draw is close to 250W with peak nearing 400W.\"\n        src=\"/static/60d4622c64534c340d0953f7d726ac19/f058b/avx.png\"\n        srcset=\"/static/60d4622c64534c340d0953f7d726ac19/c26ae/avx.png 158w,\n/static/60d4622c64534c340d0953f7d726ac19/6bdcf/avx.png 315w,\n/static/60d4622c64534c340d0953f7d726ac19/f058b/avx.png 630w,\n/static/60d4622c64534c340d0953f7d726ac19/40601/avx.png 945w,\n/static/60d4622c64534c340d0953f7d726ac19/78612/avx.png 1260w,\n/static/60d4622c64534c340d0953f7d726ac19/91b67/avx.png 1527w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<center>\nAlt: Power draw of latest Intel 11th Generation Rocket Lake series running 3DPMavx in AVX-512 mode. The average power draw is close to 250W with peak nearing 400W.\n<br/>\nSource (link opens a new tab): <a href=\"https://www.anandtech.com/show/16495/intel-rocket-lake-14nm-review-11900k-11700k-11600k/5\" target=\"_blank\">https://www.anandtech.com/show/16495/intel-rocket-lake-14nm-review-11900k-11700k-11600k/5</a>\n</center>\n<br/>\n<p>As we see there is indeed a significant difference in the power draw between a normal workload and workload that depends on SIMD processing.</p>\n<h3>Complications</h3>\n<p>The following are the complications to power analysis:</p>\n<ul>\n<li>Attacker must be able to accurately observe and record power draw of the CPU.</li>\n<li>In some systems, power draw of entire system might not capture CPU state due to presence of other computation hardware.</li>\n<li>Careful analysis needs to be performed on power draw data infer correct results. </li>\n</ul>\n<p>We can see, as a result of the non-uniformity in power consumption by different units of CPU, the power consumption becomes a side-channel to extract information from the unsuspecting system.</p>\n<h2>Coming up next</h2>\n<p>We’ll take a brief detour from Power Analysis and look at other exploits and emerging memory architecture but we’ll come back to power analysis to see a real world exploit based on the concepts discussed here.</p>\n<p>Thank you for reading till the end. I’m an undergraduate student keenly interested in Computer Architecture and I look at micro-architectural based attacks to understand more about the working of our hardware. If you find any inaccuracies in the above post, please leave a comment and I’ll address it in the next edit. Have a nice day! </p>","frontmatter":{"title":"Power Analysis","date":"July 02, 2021","description":"Just like ho measuring time taken to run instruction can give insights on runtime of victim program, measuring power consumption of CPU can also give insights on runtime of program. In this post, we lay the groundwork for understanding attacks that uses power consumption as a side channel to leak secrets from victim's address space."}},"previous":{"fields":{"slug":"/spectre/"},"frontmatter":{"title":"Spectre: Exploiting speculative execution"}},"next":{"fields":{"slug":"/m1racles/"},"frontmatter":{"title":"M1RACLES: M1ssing Register Access Controls Leak EL0 State"}}},"pageContext":{"id":"aa7d2a4b-b08d-53e8-9690-b5374fa7095b","previousPostId":"899bb99c-50f9-5441-9207-d96e88ce85d5","nextPostId":"a65f04e2-8b7e-5a13-b748-7b26fb714aec"}},"staticQueryHashes":["2841359383","3257411868"]}